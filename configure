#!/bin/bash

set -euo pipefail

main () {
    sanity_check
    install_python_deps
}

sanity_check () {
    which virtualenv >/dev/null \
        || (
            echo "Can't find virtualenv, install that first: sudo pip install virtualenv"
            exit 1
            )

    which brew >/dev/null \
        || which sentry-cli >/dev/null \
        || (
            echo "Can't find brew or sentry-cli, install either to continue"
            exit 1
            )
}

install_python_deps () {
    test -d venv || virtualenv venv -p $(which python3)
    ./venv/bin/pip install -r requirements.txt
}

install_sentry_cli () {
    brew install getsentry/tools/sentry-cli
}

main
